<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet"
    />
    <title>Typing Game - Space Themed UI</title>
    <style>
      :root {
        color-scheme: light dark;
        --green: #00b755;
        --yellow: #daaf38;
        --red: #ca4754;
        --black: #181e28;
        --gray: #aaa;
        --blue: #66ccff;
        --dark-gray: #2a3b4f;
      }
      html,
      body {
        margin: 0;
      }

      body {
        background: var(--black);
        font-weight: 400;
        font-family: "IBM Plex Mono Thin italic", monospace;
        color: #fff;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 32px;
        margin: 0;
        font-size: 13px;
        min-height: 93vh;
      }

      header {
        background-color: var(--dark-gray);
        width: 100%;
        padding: 10px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-sizing: border-box;
        border-top: 1px solid rgb(255, 255, 255);
        border-left: 1px solid rgb(255, 255, 255);
        border-right: 1px solid rgb(255, 255, 255);
      }

      h1 {
        margin: 0;
        font-size: 18px;
      }

      nav a {
        color: #fff;
        text-decoration: none;
        margin-left: 20px;
      }

      .game-container {
        display: flex;
        justify-content: space-between;
        width: 100%;
        flex: 1;
      }

      .stats {
        width: 250px;
        padding: 20px 20px 0px 20px;

        border: 1px solid rgb(255, 255, 255);
      }

      .stat {
        margin-bottom: 20px;
        background-color: #2a3b4f;
        padding: 5px;
      }

      .stat-label {
        font-size: 14px;
        color: var(--gray);
      }

      .stat-value {
        font-size: 25px;
        font-weight: bold;
      }

      .rank {
        font-size: 12px;
        color: var(--gray);
      }

      .category {
        margin-top: 40px;
      }

      .category-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      .category-button {
        background-color: hsl(0, 0%, 50.2%);
        border: none;
        color: #fff;
        padding: 5px 15px;
        cursor: pointer;
        font-size: 16px;
      }

      .typing-area {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        background-color: var(--dark-gray);
        padding: 20px;
        border-top: 1px solid rgb(255, 255, 255);
        border-right: 1px solid rgb(255, 255, 255);
        border-bottom: 1px solid rgb(255, 255, 255);
      }

      .typing-area word {
        margin-right: 10px;
      }

      .typing-area p {
        margin: 0;
        font-size: 24px;
        color: var(--gray);
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      letter.correct {
        color: var(--green);
      }

      letter.incorrect {
        color: var(--red);
      }

      letter.active::before {
        content: "|";
        color: var(--yellow);
        animation: blink 1s infinite;
        margin: -7px;
      }

      @keyframes blink {
        0%,
        50% {
          opacity: 1;
        }
        51%,
        100% {
          opacity: 0;
        }
      }

      button {
        background: var(--blue);
        color: white;
        border: none;
        padding: 10px;
        background-color: hsl(0, 0%, 50.2%);
        font-size: 18px;
        cursor: pointer;
        margin-top: 20px;
      }

      button:hover {
        background: #44aaff;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Mechanography</h1>
      <nav>
        <a href="#">Home</a>
        <a href="#">Leaderboard</a>
        <a href="#">Settings</a>
      </nav>
    </header>

    <div class="game-container">
      <div class="stats">
        <div class="stat">
          <div class="stat-label">Accuracy</div>
          <div class="stat-value" id="accuracy">0%</div>
        </div>
        <div class="stat">
          <div class="stat-label">Words Per Minute</div>
          <div class="stat-value" id="wpm">0</div>
        </div>
        <div class="stat">
          <div class="stat-label">Rank</div>
          <div class="stat-value" id="rank">-</div>
          <div class="rank" id="rank-percentile"></div>
        </div>
        <div class="stat">
          <div class="stat-label">Time Remaining</div>
          <div class="stat-value" id="time">30s</div>
        </div>
        <div class="stat">
          <div class="stat-label">Category</div>
          <div class="category-buttons">
            <button class="category-button">Space</button>
            <button class="category-button">HTML</button>
            <button class="category-button">CSS</button>
            <button class="category-button">JavaScript</button>
          </div>
        </div>
      </div>

      <div class="typing-area">
        <p id="text-area"></p>
        <button id="reset">Reset</button>
      </div>
    </div>

    <script type="module">
      import { words as INITIAL_WORDS } from "./data.js";

      const $time = document.querySelector("#time");
      const $paragraph = document.querySelector("#text-area");
      const $accuracy = document.querySelector("#accuracy");
      const $wpm = document.querySelector("#wpm");
      const $rank = document.querySelector("#rank");
      const $rankPercentile = document.querySelector("#rank-percentile");
      const $resetButton = document.querySelector("#reset");

      const INITIAL_TIME = 30;
      let words = [];
      let currentTime = INITIAL_TIME;
      let correctWords = 0;
      let correctLetters = 0;
      let incorrectLetters = 0;
      let playing = false;

      function initGame() {
        playing = false;
        words = INITIAL_WORDS.sort(() => Math.random() - 0.5).slice(0, 50);
        currentTime = INITIAL_TIME;
        correctWords = 0;
        correctLetters = 0;
        incorrectLetters = 0;
        $time.textContent = `${currentTime}s`;
        $accuracy.textContent = `0%`;
        $wpm.textContent = `0`;
        $rank.textContent = `-`;
        $rankPercentile.textContent = ``;

        $paragraph.innerHTML = words
          .map((word) => {
            return `<word>${[...word]
              .map((letter) => `<letter>${letter}</letter>`)
              .join("")}</word>`;
          })
          .join("");

        const firstWord = $paragraph.querySelector("word");
        firstWord.classList.add("active");
        firstWord.querySelector("letter").classList.add("active");
      }

      function startGame() {
        if (playing) return;
        playing = true;

        const interval = setInterval(() => {
          currentTime--;
          $time.textContent = `${currentTime}s`;

          if (currentTime === 0) {
            clearInterval(interval);
            gameOver();
          }
        }, 1000);
      }

      function gameOver() {
        playing = false;
        const totalLetters = correctLetters + incorrectLetters;
        const accuracy =
          totalLetters > 0 ? (correctLetters / totalLetters) * 100 : 0;
        $accuracy.textContent = `${accuracy.toFixed(2)}%`;
        const wpm = (correctWords * 60) / INITIAL_TIME;
        $wpm.textContent = `${wpm.toFixed(0)}`;

        // Simulate rank calculation (you may want to implement a real ranking system)
        const rank = Math.floor(Math.random() * 100) + 1;
        $rank.textContent = `${rank}`;
        $rankPercentile.textContent = `Top ${
          Math.floor(Math.random() * 20) + 1
        }% of players`;
      }

      document.addEventListener("keydown", (e) => {
        if (!playing) startGame();

        const activeWord = $paragraph.querySelector("word.active");
        const activeLetter = activeWord.querySelector("letter.active");
        const currentWord = activeWord.innerText.trim();

        if (e.key === " ") {
          e.preventDefault();
          const hasErrors =
            activeWord.querySelectorAll("letter:not(.correct)").length > 0;
          if (!hasErrors) correctWords++;

          activeWord.classList.remove("active");
          const nextWord = activeWord.nextElementSibling;
          if (nextWord) {
            nextWord.classList.add("active");
            nextWord.querySelector("letter").classList.add("active");
          }
          return;
        }

        if (e.key === "Backspace") {
          e.preventDefault();
          const prevLetter = activeLetter.previousElementSibling;
          if (prevLetter) {
            activeLetter.classList.remove("active");
            prevLetter.classList.add("active");
          }
          return;
        }

        if (/^[a-zA-Z]$/.test(e.key)) {
          const letterClass =
            e.key === activeLetter.innerText ? "correct" : "incorrect";
          activeLetter.classList.add(letterClass);
          letterClass === "correct" ? correctLetters++ : incorrectLetters++;

          activeLetter.classList.remove("active");
          const nextLetter = activeLetter.nextElementSibling;
          if (nextLetter) {
            nextLetter.classList.add("active");
          }
        }
      });

      $resetButton.addEventListener("click", initGame);
      initGame();
    </script>
  </body>
</html>
